(()=>{var e,t,n,o,i=document.getElementsByClassName("js-globe")[0],a={},l={main:null,globe:null,globeDots:null,lines:null,lineDots:null},r={mapSize:{width:1024,height:512},globeRadius:200,dotsAmount:20,startingCountry:"hongkong",colours:{globeDots:"#00b14f",lines:new THREE.Color("#00b14f"),lineDots:new THREE.Color("#00b14f")},alphas:{globe:.7,lines:.5}},s={object:null,controls:null,angles:{current:{azimuthal:null,polar:null},target:{azimuthal:null,polar:null}}},u={finishedIntro:!1,dots:{current:0,total:170,points:[]},globe:{current:0,total:80},countries:{active:!1,animating:!1,current:0,total:120,selected:null,index:null,timeout:null,initialDuration:5e3,duration:2e3}},c=!1,d=!1;function h(){alert("WebGL not supported. Please use a browser that supports WebGL.")}function g(){n.render(t,s.object)}function p(e){var t="visible",n="hidden",o={focus:t,focusin:t,pageshow:t,blur:n,focusout:n,pagehide:n};e=e||window.event,c=e.type in o}function m(){!1===c&&requestAnimationFrame(m),l.globeDots&&function(){if(u.dots.current<=u.dots.total){for(var e=l.globeDots.geometry.vertices,t=e.length,n=0;n<t;n++){var o=w(u.dots.current/u.dots.total);if((o+=o*(n/t))>1&&(o=1),e[n].x=u.dots.points[n].x*o,e[n].y=u.dots.points[n].y*o,e[n].z=u.dots.points[n].z*o,0===n){var i=(s.angles.current.azimuthal-s.angles.target.azimuthal)*o;i=s.angles.current.azimuthal-i,s.controls.setAzimuthalAngle(i);var a=(s.angles.current.polar-s.angles.target.polar)*o;a=s.angles.current.polar-a}}u.dots.current++,l.globeDots.geometry.verticesNeedUpdate=!0,document.querySelector(".svg-wrapper").classList.add("active"),document.querySelector(".btn-play-video").classList.add("active"),document.querySelector(".globe-title").classList.add("active")}if(u.dots.current>=.65*u.dots.total&&u.globe.current<=u.globe.total){var c=(d=u.globe.current/u.globe.total,--d*d*d+1);globe.material.opacity=r.alphas.globe*c,u.globe.current++}var d;!0===u.countries.active&&!1===u.finishedIntro&&(u.finishedIntro=!0,u.countries.timeout=setTimeout(f,u.countries.initialDuration),function(){for(var e=r.globeRadius/120,t=32,n=32,o=new THREE.SphereGeometry(e,t,n),i=new THREE.MeshBasicMaterial({color:r.colours.lineDots}),a=function(){return new THREE.Mesh(o,i)},s=0;s<r.dotsAmount;s++){var u=a();u.visible=!1,u._pathIndex=null,u._path=null,l.lineDots.add(u)}}())}(),!0===u.finishedIntro&&function(){for(var e=0;e<l.lineDots.children.length;e++){var t=l.lineDots.children[e];if(null===t._path)Math.random()>.99&&(b(t),t._pathIndex=0);else null!==t._path&&t._pathIndex<t._path.length-1?(!1===t.visible&&(t.visible=!0),t.position.x=t._path[t._pathIndex].x,t.position.y=t._path[t._pathIndex].y,t.position.z=t._path[t._pathIndex].z,t._pathIndex++):(t.visible=!1,t._path=null)}}(),!0===u.countries.animating&&function(){if(u.countries.current<=u.countries.total){var e=(o=u.countries.current/u.countries.total)<.5?2*o*o:(4-2*o)*o-1,t=(s.angles.current.azimuthal-s.angles.target.azimuthal)*e;t=s.angles.current.azimuthal-t,s.controls.setAzimuthalAngle(t);var n=(s.angles.current.polar-s.angles.target.polar)*e;n=s.angles.current.polar-n,u.countries.current++}else u.countries.animating=!1,u.countries.current=0,u.countries.timeout=setTimeout(f,u.countries.duration);var o}(),s.controls.setAzimuthalAngle(-360*Math.cos(5e-7*Date.now())),s.controls.setPolarAngle(1),s.controls.update(),g()}function b(e){var t=Math.random()*(u.countries.selected.children.length-1);t=u.countries.selected.children[t.toFixed(0)],e._path=t._path}"hidden"in document?document.addEventListener("visibilitychange",p):"mozHidden"in document?document.addEventListener("mozvisibilitychange",p):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",p):"msHidden"in document?document.addEventListener("msvisibilitychange",p):"onfocusin"in document?document.onfocusin=document.onfocusout=p:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=p;var v,w=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};function E(e,t){for(var n in void 0!==u.countries.selected&&(u.countries.selected.visible=!1),a)n===e?a[n].element.classList.add("active"):a[n].element.classList.remove("active");if(u.countries.selected=l.lines.getObjectByName(e),u.countries.selected.visible=!0,!0!==t){s.angles.current.azimuthal=s.controls.getAzimuthalAngle(),s.angles.current.polar=s.controls.getPolarAngle();var i=function(e,t){var n=(e-r.mapSize.width)/r.mapSize.width*Math.PI;n=(n+=Math.PI/2)+.1;var o=t/(2*r.mapSize.height)*Math.PI;return{azimuthal:n,polar:o}}(o.countries[e].x,o.countries[e].y);s.angles.target.azimuthal=i.azimuthal,s.angles.target.polar=i.polar,u.countries.animating=!0,function(){for(var e=0;e<l.lineDots.children.length;e++){var t=l.lineDots.children[e];null!==t._path&&null!==t._pathIndex&&b(t)}}()}}function f(){u.countries.index++,u.countries.index>=Object.keys(o.countries).length&&(u.countries.index=0),E(Object.keys(o.countries)[u.countries.index],!1)}function z(e,t){e=(e-r.mapSize.width)/r.mapSize.width*-180,t=(t-r.mapSize.height)/r.mapSize.height*-90;var n=Math.cos(t/180*Math.PI)*r.globeRadius;return{x:Math.cos(e/180*Math.PI)*n,y:Math.sin(t/180*Math.PI)*r.globeRadius,z:Math.sin(e/180*Math.PI)*n}}window.WebGLRenderingContext?((v=new XMLHttpRequest).open("GET",urlPointGlobeJson,!0),v.onload=function(){v.status>=200&&v.status<400?(o=JSON.parse(v.responseText),$(window).scroll((function(){var a=$("#impressive-numbers").offset().top,c=$(window),h=$(window).height();a-=300,c.scrollTop()+h>=a&&(d||(d=!0,e=i.getElementsByClassName("js-canvas")[0],t=new THREE.Scene,(n=new THREE.WebGLRenderer({canvas:e,antialias:!0,alpha:!0,shadowMapEnabled:!1})).setSize(e.clientWidth,e.clientHeight),n.setPixelRatio(1),n.setClearColor(0,0),l.main=new THREE.Group,l.main.name="Main",l.lines=new THREE.Group,l.lines.name="Lines",l.main.add(l.lines),l.lineDots=new THREE.Group,l.lineDots.name="Dots",l.main.add(l.lineDots),t.add(l.main),s.object=new THREE.PerspectiveCamera(60,e.clientWidth/e.clientHeight,1,1e4),s.object.position.z=2.6*r.globeRadius,s.controls=new OrbitControls(s.object,e),s.controls.enableKeys=!1,s.controls.enablePan=!1,s.controls.enableZoom=!1,s.controls.enableDamping=!1,s.controls.enableRotate=!1,s.angles.current.azimuthal=-Math.PI,s.angles.current.polar=180,function(){(new THREE.TextureLoader).setCrossOrigin(!0);var e=r.globeRadius-.02*r.globeRadius,t=64,n=64,i=128,a=document.createElement("canvas");a.width=i,a.height=i;var s=a.getContext("2d");s.rect(0,0,i,i);var c=s.createLinearGradient(0,0,0,i);c.addColorStop(1,"rgba(0,0,0,0.02)"),c.addColorStop(1,"rgba(0,0,0,0.02)"),c.addColorStop(1,"rgba(0,0,0,0.02)"),s.fillStyle=c,s.fill();var d=new THREE.Texture(a);d.needsUpdate=!0;var h=new THREE.SphereGeometry(e,t,n),g=new THREE.MeshBasicMaterial({map:d,transparent:!0,opacity:0});globe=new THREE.Mesh(h,g),l.globe=new THREE.Group,l.globe.name="Globe",l.globe.add(globe),l.main.add(l.globe),function(){var e=new THREE.Geometry,t=16,n=t/2,i=document.createElement("canvas");i.width=t,i.height=t;var a=i.getContext("2d");a.beginPath(),a.arc(n,n,n,0,2*Math.PI),a.fillStyle=r.colours.globeDots,a.fill();var s=new THREE.Texture(i);s.needsUpdate=!0;for(var c=new THREE.PointsMaterial({map:s,size:r.globeRadius/200}),d=function(t,n){var o=new THREE.Vector3(0,0,0);e.vertices.push(o);var i=z(t,n);u.dots.points.push(new THREE.Vector3(i.x,i.y,i.z))},h=0;h<o.points.length;h++)d(o.points[h].x,o.points[h].y);for(var g in o.countries)d(o.countries[g].x,o.countries[g].y);l.globeDots=new THREE.Points(e,c),l.globe.add(l.globeDots)}()}(),g(),m()))}))):h()},v.onerror=h,v.send()):h()})();